"use strict";(self.webpackChunkwire_docs=self.webpackChunkwire_docs||[]).push([[2300],{6190:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var c=n(74848),o=n(28453);const i={sidebar_position:3,id:"company-contract",title:"Create Company Contract",toc_max_heading_level:5,toc_min_heading_level:2},r="Company Contract",a={id:"smart-contract-development/company-contract",title:"Create Company Contract",description:"Overview",source:"@site/docs/smart-contract-development/company-contract.md",sourceDirName:"smart-contract-development",slug:"/smart-contract-development/company-contract",permalink:"/wire-docs/docs/smart-contract-development/company-contract",draft:!1,unlisted:!1,editUrl:"https://github.com/Wire-Network/wire-docs/docs/smart-contract-development/company-contract.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,id:"company-contract",title:"Create Company Contract",toc_max_heading_level:5,toc_min_heading_level:2},sidebar:"contentSidebar",previous:{title:"Quick Start: Hello World Contract",permalink:"/wire-docs/docs/smart-contract-development/hello-world-contract-short"},next:{title:"Interacting with Contracts",permalink:"/wire-docs/docs/category/interacting-with-contracts"}},s={},l=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step-by-Step Guide to Creating a <em>Company Contract</em> Smart Contract",id:"step-by-step-guide-to-creating-a-company-contract-smart-contract",level:2},{value:"1. Set Up Your Contract Workspace",id:"1-set-up-your-contract-workspace",level:3},{value:"2. Write the Contract Code",id:"2-write-the-contract-code",level:3},{value:"2.1. Define the <code>employees</code> contract class",id:"21-define-the-employees-contract-class",level:4},{value:"2.2. Define the Employee Struct and Multi-Index Table",id:"22-define-the-employee-struct-and-multi-index-table",level:4},{value:"2.3. Defining the <code>upsertemp()</code> action",id:"23-defining-the-upsertemp-action",level:4},{value:"2.4. Defining the <code>getall()</code> action",id:"24-defining-the-getall-action",level:4},{value:"3. Compile the Contract",id:"3-compile-the-contract",level:3},{value:"4. Deploy the Contract",id:"4-deploy-the-contract",level:3},{value:"4.1 Retrieve public key",id:"41-retrieve-public-key",level:4},{value:"4.2 Deploy the compiled contract",id:"42-deploy-the-compiled-contract",level:4}];function d(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(t.header,{children:(0,c.jsx)(t.h1,{id:"company-contract",children:"Company Contract"})}),"\n",(0,c.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,c.jsx)(t.p,{children:"This page will guide you to creating and developing a simple contract using Wire CDT and C++ language. While prior knowledge of C++ is not necessary for this tutorial, we encourage you to familiarize yourself with the basics of C++ to enhance your understanding."}),"\n",(0,c.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsx)(t.li,{children:(0,c.jsx)(t.a,{href:"/wire-docs/docs/smart-contract-development/smart-contract-basics",children:"Smart Contract Basics"})}),"\n"]}),"\n",(0,c.jsxs)(t.h2,{id:"step-by-step-guide-to-creating-a-company-contract-smart-contract",children:["Step-by-Step Guide to Creating a ",(0,c.jsx)(t.em,{children:"Company Contract"})," Smart Contract"]}),"\n",(0,c.jsx)(t.h3,{id:"1-set-up-your-contract-workspace",children:"1. Set Up Your Contract Workspace"}),"\n",(0,c.jsxs)(t.p,{children:["Navigate to a directory of your choice and create a new subdirectory for your contract, along with its content ",(0,c.jsx)(t.code,{children:"include/"})," and ",(0,c.jsx)(t.code,{children:"src/"}),"."]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",metastring:'title="/your-contracts-workspace"',children:"mkdir company-contract && cd company-contract && mkdir include src company && touch include/company.hpp src/company.cpp\n"})}),"\n",(0,c.jsxs)(t.p,{children:["Open ",(0,c.jsx)(t.code,{children:"company-contract"})," in your preferred text editor to begin coding."]}),"\n",(0,c.jsx)(t.h3,{id:"2-write-the-contract-code",children:"2. Write the Contract Code"}),"\n",(0,c.jsx)(t.p,{children:"In C++, splitting class declarations and definitions into separate header (.hpp) and source  (.cpp) files is a common practice that promotes better code organization, readability, and compile time-efficiency. This approach helps segregating interface from implementation; as well hiding the implementation details from other parts of the program and exposing only what is necessary. For the purposes of this and future tutorials, we will stick to that approach."}),"\n",(0,c.jsxs)(t.p,{children:["2.1. Define contract interfaces in ",(0,c.jsx)(t.code,{children:"company.hpp"})]}),"\n",(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsxs)(t.li,{children:["The ",(0,c.jsx)(t.code,{children:"sysio/sysio.hpp"})," header file contains necessary classes and built-in utility functions for contract development."]}),"\n"]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-cpp",metastring:'title="/your-contracts-workspace/company-contract/company.hpp"',children:"#pragma once\n\n#include <sysio/sysio.hpp>\n#include <string>\n\nusing namespace sysio;\n"})}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsxs)(t.h4,{id:"21-define-the-employees-contract-class",children:["2.1. Define the ",(0,c.jsx)(t.code,{children:"employees"})," contract class"]}),"\n",(0,c.jsxs)(t.p,{children:["You can use either the simplified or the long syntax for defining contracts. In this tutorial we will be using primarily the short syntax for better readability. We would also define two actions ",(0,c.jsx)(t.code,{children:"upsertemp()"})," and ",(0,c.jsx)(t.code,{children:"getallemp()"}),"."]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-cpp",metastring:'title="/your-contracts-workspace/company-contract/company.hpp"',children:"#pragma once\n\n#include <sysio/sysio.hpp>\n#include <string>\n\nusing namespace sysio;\n\n// highlight-start\n// Using short syntax for structs\nCONTRACT company : public contract {\n    public:\n        using contract::contract;\n\n    // Action to upsert (insert or update) an employee record\n    ACTION upsertemp(name user, const std::string& name, const std::string& email, const std::string& status);\n\n    // Action to retrieve and print all employee records\n    ACTION getallemp();\n}\n// highlight-end\n"})}),"\n",(0,c.jsxs)(t.admonition,{type:"info",children:[(0,c.jsx)(t.p,{children:(0,c.jsx)(t.strong,{children:"Long syntax"})}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-cpp",children:'// Using long syntax for structs\nclass [[sysio::contract("employees")]] employees : public contract {\npublic:\n    using contract::contract;  // Inherits the base contract constructor.\n\n    employees(name receiver, name code, datastream<const char*> ds) : contract(receiver, code, ds) {}\n\n};\n'})})]}),"\n",(0,c.jsxs)(t.admonition,{title:"LEARN",type:"tip",children:[(0,c.jsxs)(t.p,{children:["The short syntax in C++ contracts, such as those used in the Wire blockchain framework, is possible due to the language\u2019s support for preprocessor's directive like ",(0,c.jsx)(t.code,{children:"#define"}),". This directive is a preprocessor command that creates ",(0,c.jsx)(t.em,{children:"macros"}),", serving as symbolic names or aliases for code fragments. Before compilation, the preprocessor scans the source code and replaces these macros with their defined sequences. Essentially, ",(0,c.jsx)(t.code,{children:"#define"})," allows developers to define constants, create function-like macros, or insert code snippets, improving readability and maintainability by eliminating repetitive code segments."]}),(0,c.jsx)(t.p,{children:(0,c.jsx)(t.a,{href:"https://github.com/Wire-Network/wire-cdt/blob/main/libraries/sysiolib/contracts/sysio/contract.hpp#L18",children:"Source code"})}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-cpp",metastring:"title=wire-cdt/libraries/sysiolib/contracts/sysio/contract.hpp",children:"#define CONTRACT class [[sysio::contract]]\n"})})]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h4,{id:"22-define-the-employee-struct-and-multi-index-table",children:"2.2. Define the Employee Struct and Multi-Index Table"}),"\n",(0,c.jsxs)(t.p,{children:["Within the employees contract class, let's add a struct named ",(0,c.jsx)(t.code,{children:"employee"})," to represent the table that holds individual employee records. We will define it with several fields:"]}),"\n",(0,c.jsxs)(t.p,{children:["\u2022 ",(0,c.jsx)(t.code,{children:"user"}),": The name of the employee, which will serve as the primary key for the table. It uniquely identifies each employee record."]}),"\n",(0,c.jsxs)(t.p,{children:["\u2022 ",(0,c.jsx)(t.code,{children:"name"}),": A string that stores the full name of the employee."]}),"\n",(0,c.jsxs)(t.p,{children:["\u2022 ",(0,c.jsx)(t.code,{children:"email"}),": A string representing the employee\u2019s email address."]}),"\n",(0,c.jsxs)(t.p,{children:["\u2022 ",(0,c.jsx)(t.code,{children:"status"}),': A string that indicates the current status of the employee within the organization. (e.g., \u201cactive\u201d, \u201cinactive").']}),"\n",(0,c.jsxs)(t.p,{children:["The ",(0,c.jsx)(t.code,{children:"primary_key()"})," function within the struct returns the ",(0,c.jsx)(t.code,{children:"user.value"}),", which is the numeric representation of the user.\nThe multi_index container named ",(0,c.jsx)(t.code,{children:"employee_index"})," is defined to manage the storage of these records. It allows for efficient storing, updating, and querying of employee data based on the primary key."]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-cpp",metastring:'title="/your-contracts-workspace/company-contract/company.hpp"',children:'#pragma once\n\n#include <sysio/sysio.hpp>\n#include <string>\n\nusing namespace sysio;\n\nCONTRACT company : public contract {\n    public:\n        using contract::contract;\n\n    // Action to upsert (insert or update) an employee record\n    ACTION upsertemp(name user, const std::string& name, const std::string& email, const std::string& status);\n\n    // Action to retrieve and print all employee records\n    ACTION getallemp();\n\n    // highlight-start\n    private:\n        // Employee struct representing a record in the employees table.\n        TABLE employee {\n            name user;\n            std::string name;\n            std::string email;\n            std::string status;\n\n            uint64_t primary_key() const { return user.value; }\n        };\n        // Type definition for the multi-index table handling employee records.\n        using employee_index = sysio::multi_index<"employees"_n, employee>;\n    // highlight-end\n};\n'})}),"\n",(0,c.jsxs)(t.p,{children:["Next let's define the implementation for the actions ",(0,c.jsx)(t.code,{children:"upsertemp"})," and ",(0,c.jsx)(t.code,{children:"getallemp"}),"."]}),"\n",(0,c.jsxs)(t.h4,{id:"23-defining-the-upsertemp-action",children:["2.3. Defining the ",(0,c.jsx)(t.code,{children:"upsertemp()"})," action"]}),"\n",(0,c.jsxs)(t.p,{children:[(0,c.jsx)(t.code,{children:"upsertemp"}),"  will be used for upserting an employee record. Refer to the comments within the code for more explanation of what each line/block do."]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-cpp",metastring:'title="/your-contracts-workspace/company-contract/company.cpp"',children:'#include <sysio/print.hpp>\n#include <company.hpp>\n\n\nvoid company::upsertemp(name user, const std::string& name, const std::string& email, const std::string& status) {\n    require_auth(user); //built-in method that only the authenticated user can execute this action\n    // Including the require_auth() method in this action ensures that only authenticated users, typically those verified to be the smart contract\u2019s account or another authorized account, can initiate these actions. This method is typically used for actions that involve sensitive operations like updating a user record. By requiring authentication, you can safeguard customer-specific actions, ensuring that such operations are performed exclusively by the account owner and not by unauthorized parties.\n\n    // Access the table with `get_self()` as the scope\n    employee_index emp_table(get_self(), get_self().value);\n\n    // Find the record with PK matching the user\n    auto employee_itr = emp_table.find(user.value);\n\n    if (employee_itr == emp_table.end()) {\n        // If no record is found, create a new one\n        emp_table.emplace(user, [&](auto& new_employee) {\n            new_employee.user = user;\n            new_employee.name = name;\n            new_employee.email = email;\n            new_employee.status = status;\n        });\n        print("Employee added: ", user);\n    } else {\n        // Modify the record if the user matches\n        emp_table.modify(employee_itr, user, [&](auto& mod_employee) {\n            mod_employee.name = name;\n            mod_employee.email = email;\n            mod_employee.status = status;\n        });\n        print("Employee updated: ", user);\n    } \n}\n'})}),"\n",(0,c.jsxs)(t.h4,{id:"24-defining-the-getall-action",children:["2.4. Defining the ",(0,c.jsx)(t.code,{children:"getall()"})," action"]}),"\n",(0,c.jsx)(t.p,{children:"The action below will retrieve all employee records from the employees multi-index table."}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-cpp",metastring:'title="/your-contracts-workspace/company-contract/company.cpp"',children:'void company::getallemp() {\n    employee_index emp_table(get_self(), get_self().value);\n    for (auto itr = emp_table.begin(); itr != emp_table.end(); itr++) {\n        print("Employee ID: ", itr->user, ", Name: ", itr->name, ", Email: ", itr->email, ", Status: ", itr->status, "\\n");\n    }\n}\n'})}),"\n",(0,c.jsx)(t.h3,{id:"3-compile-the-contract",children:"3. Compile the Contract"}),"\n",(0,c.jsxs)(t.p,{children:["Compile your contract into WebAssembly (WASM) format using the Wire Contract Development Toolkit (CDT). This command also generates the ABI file in the ",(0,c.jsx)(t.code,{children:"company"})," folder."]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"cdt-cpp -abigen -contract company -o company/company.wasm src/company.cpp -I include\n"})}),"\n",(0,c.jsx)(t.h3,{id:"4-deploy-the-contract",children:"4. Deploy the Contract"}),"\n",(0,c.jsx)(t.p,{children:"Before deploying, ensure you have an open wallet and account to deploy the contract to."}),"\n",(0,c.jsx)(t.admonition,{type:"note",children:(0,c.jsx)(t.p,{children:"In Wire ecosystem, deploying a smart contract requires an account; an account can own one smart contract instance and a smart contract instance must be deployed to an account. Each account functions as a distinct namespace for the contract, which means that the contract\u2019s code and its state are encapsulated within that account."})}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h4,{id:"41-retrieve-public-key",children:"4.1 Retrieve public key"}),"\n",(0,c.jsxs)(t.p,{children:["Before proceeding, make sure you have the public key available from the key pair that was created when setting up your wallet. If you haven\u2019t yet created a wallet or a key pair, you can do so by following the instructions ",(0,c.jsx)(t.a,{href:"/wire-docs/docs/getting-started/create-development-wallet",children:"here"}),"."]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"export PUBLIC_KEY=<public-key-value>\n"})}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"clio create account sysio company $PUBLIC_KEY -p sysio@active\n"})}),"\n",(0,c.jsx)(t.h4,{id:"42-deploy-the-compiled-contract",children:"4.2 Deploy the compiled contract"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"                  [account] [WASM dir]  [permission level] \nclio set contract company  company -p  company@active\n"})}),"\n",(0,c.jsxs)(t.p,{children:["The smart contract should now be live on your local blockchain. You can inspect through ",(0,c.jsx)(t.a,{href:"https://eosauthority.com/",children:"Block Explorer"}),"."]})]})}function p(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,c.jsx)(t,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var c=n(96540);const o={},i=c.createContext(o);function r(e){const t=c.useContext(i);return c.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),c.createElement(i.Provider,{value:t},e.children)}}}]);