"use strict";(self.webpackChunkwire_docs=self.webpackChunkwire_docs||[]).push([[3914],{25650:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var i=t(74848),s=t(28453);const o={},a=void 0,r={id:"api-reference/wire-cdt/best-practices/abi/abi-code-generator-attributes-explained",title:"abi-code-generator-attributes-explained",description:"\x3c!-- ---",source:"@site/docs/api-reference/wire-cdt/best-practices/abi/abi-code-generator-attributes-explained.md",sourceDirName:"api-reference/wire-cdt/best-practices/abi",slug:"/api-reference/wire-cdt/best-practices/abi/abi-code-generator-attributes-explained",permalink:"/docs/api-reference/wire-cdt/best-practices/abi/abi-code-generator-attributes-explained",draft:!1,unlisted:!1,editUrl:"https://github.com/Wire-Network/wire-docs/edit/master/docs/api-reference/wire-cdt/best-practices/abi/abi-code-generator-attributes-explained.md",tags:[],version:"current",frontMatter:{}},c={},d=[{value:"[[sysio::action]]",id:"sysioaction",level:2},{value:"[[sysio::table]]",id:"sysiotable",level:2},{value:"[[sysio::contract(&quot;ANY_NAME_YOU_LIKE&quot;)]]",id:"sysiocontractany_name_you_like",level:2},{value:"[[sysio::on_notify(&quot;VALID_SYSIO_ACCOUNT_NAME::VALID_SYSIO_ACTION_NAME&quot;)]]",id:"sysioon_notifyvalid_sysio_account_namevalid_sysio_action_name",level:2},{value:"[[sysio::wasm_entry]]",id:"sysiowasm_entry",level:2},{value:"[[sysio::wasm_import]]",id:"sysiowasm_import",level:2},{value:"[[sysio::action, sysio::read-only]]",id:"sysioaction-sysioread-only",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["The new ABI generator tool uses C++11 or GNU style attributes to mark ",(0,i.jsx)(n.code,{children:"actions"})," and ",(0,i.jsx)(n.code,{children:"tables"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"sysioaction",children:"[[sysio::action]]"}),"\n",(0,i.jsx)(n.p,{children:"This attribute marks a method as an action.\nExample (four ways to declare an action for ABI generation):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// this is the C++11 and greater style attribute\n[[sysio::action]]\nvoid testa( name n ) {\n   // do something\n}\n\n// this is the GNU style attribute, this can be used in C code and prior to C++ 11\n__attribute__((sysio_action))\nvoid testa( name n ){\n   // do something\n}\n\nstruct [[sysio::action]] testa {\n   name n;\n   SYSLIB_SERIALIZE( testa, (n) )\n};\n\nstruct __attribute__((sysio_action)) testa {\n   name n;\n   SYSLIB_SERIALIZE( testa, (n) )\n};\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If your action name is not a valid ",(0,i.jsx)(n.a,{href:"/docs/api-reference/wire-cdt/best-practices/naming-conventions",children:"Wire name"})," you can explicitly specify the name in the attribute ",(0,i.jsx)(n.code,{children:'c++ [[sysio::action("<valid action name>")]]'})]}),"\n",(0,i.jsx)(n.h2,{id:"sysiotable",children:"[[sysio::table]]"}),"\n",(0,i.jsx)(n.p,{children:"Example (two ways to declare a table for ABI generation):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'struct [[sysio::table]] testtable {\n   uint64_t owner;\n   /* all other fields */\n};\n\nstruct __attribute__((sysio_table)) testtable {\n   uint64_t owner;\n   /* all other fields */\n};\n\ntypedef sysio::multi_index<"tablename"_n, testtable> testtable_t;\n'})}),"\n",(0,i.jsxs)(n.p,{children:["If you don't want to use the multi-index you can explicitly specify the name in the attribute ",(0,i.jsx)(n.code,{children:'c++ [[sysio::table("<valid action name>")]]'}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"sysiocontractany_name_you_like",children:'[[sysio::contract("ANY_NAME_YOU_LIKE")]]'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'class [[sysio::contract("ANY_NAME_YOU_LIKE")]] test_contract : public sysio::contract {\n};\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The code above will mark this ",(0,i.jsx)(n.code,{children:"class"})," as being a Wire contract, this allows for namespacing of contracts, i.e. you can include headers like ",(0,i.jsx)(n.code,{children:"sysio::token"})," and not have ",(0,i.jsx)(n.code,{children:"sysio::token"}),"'s actions/tables wind up in you ABI or generated dispatcher."]}),"\n",(0,i.jsx)(n.h2,{id:"sysioon_notifyvalid_sysio_account_namevalid_sysio_action_name",children:'[[sysio::on_notify("VALID_SYSIO_ACCOUNT_NAME::VALID_SYSIO_ACTION_NAME")]]'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'[[sysio::on_notify("sysio.token::transfer")]]\nvoid on_token_transfer(name from, name to, assert quantity, std::string memo) {\n   // do something on sysio.token contract\'s transfer action from any account to the account where the contract is deployed.\n}\n\n[[sysio::on_notify("*::transfer")]]\nvoid on_any_transfer(name from, name to, assert quantity, std::string memo) {\n   // do something on any contract\'s transfer action from any account to the account where the contract is deployed.\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"sysiowasm_entry",children:"[[sysio::wasm_entry]]"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"[[sysio::wasm_entry]]\nvoid some_function(...) {\n   // do something\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"The code above will mark an arbitrary function as an entry point, which will then wrap the function with global constructors (ctors) and global destructors (dtors).  This will allow for the CDT toolchain to produce WASM binaries for other ecosystems."}),"\n",(0,i.jsx)(n.h2,{id:"sysiowasm_import",children:"[[sysio::wasm_import]]"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'extern "C" {\n   __attribute__((sysio_wasm_import))\n   void some_intrinsic(...);\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"The code above will mark a function declaration as being a WebAssembly import.  This allows for other compilation modes to specify which functions are import only (i.e. do not link) without having to maintain a secondary file with duplicate declarations."}),"\n",(0,i.jsx)(n.h2,{id:"sysioaction-sysioread-only",children:"[[sysio::action, sysio::read-only]]"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"read-only"})," attribute marks a method which has been defined as an action as a read-only action."]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"[[sysio::action, sysio::read-only]]\nstd::vector<my_struct> get() {\n   std::vector<my_struct> ret;\n   // retrieve blockchain state and populate the ret vector\n   return ret; \n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Contract actions tagged read-only:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Cannot call insert/update (write) functions on the ",(0,i.jsx)(n.code,{children:"Multi-Index API"}),", nor the ",(0,i.jsx)(n.code,{children:"Key Value API"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Cannot call ",(0,i.jsx)(n.code,{children:"deferred transactions"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Cannot call ",(0,i.jsx)(n.code,{children:"inline actions"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["The amount of data returned by read-only queries is limited by the action return value size. By default these are set to 256 bytes by ",(0,i.jsx)(n.code,{children:"default_max_action_return_value_size"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"cdt-cpp"})," and ",(0,i.jsx)(n.code,{children:"cdt-cc"})," tools will generate an error and terminate compilation if an action tagged read-only attempts to call insert/update (write) functions, ",(0,i.jsx)(n.code,{children:"deferred transactions"})," or ",(0,i.jsx)(n.code,{children:"inline actions"}),". However, if the command-line override option ",(0,i.jsx)(n.code,{children:"--warn-action-read-only"})," is used, the ",(0,i.jsx)(n.code,{children:"cdt-cpp"})," and ",(0,i.jsx)(n.code,{children:"cdt-cc"})," tools will issue a warning and continue compilation."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var i=t(96540);const s={},o=i.createContext(s);function a(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);