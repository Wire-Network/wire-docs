"use strict";(self.webpackChunkwire_docs=self.webpackChunkwire_docs||[]).push([[316],{96106:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>a,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var n=o(74848),s=o(28453);const i={title:"Create a snapshot with full state history"},r=void 0,l={id:"api-reference/tooling/nodeop/how-to/how-to-create-snapshot-with-full-history",title:"Create a snapshot with full state history",description:"Goal",source:"@site/docs/api-reference/tooling/nodeop/how-to/how-to-create-snapshot-with-full-history.md",sourceDirName:"api-reference/tooling/nodeop/how-to",slug:"/api-reference/tooling/nodeop/how-to/how-to-create-snapshot-with-full-history",permalink:"/docs/api-reference/tooling/nodeop/how-to/how-to-create-snapshot-with-full-history",draft:!1,unlisted:!1,editUrl:"https://github.com/Wire-Network/wire-docs/edit/master/docs/api-reference/tooling/nodeop/how-to/how-to-create-snapshot-with-full-history.md",tags:[],version:"current",frontMatter:{title:"Create a snapshot with full state history"},sidebar:"apiReferenceSidebar",previous:{title:"Configure state storage",permalink:"/docs/api-reference/tooling/nodeop/how-to/how-to-configure-state-storage"},next:{title:"Fast start without previous history",permalink:"/docs/api-reference/tooling/nodeop/how-to/how-to-fast-start-without-old-history"}},a={},c=[{value:"Goal",id:"goal",level:2},{value:"Before you begin",id:"before-you-begin",level:2},{value:"Steps",id:"steps",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"goal",children:"Goal"}),"\n",(0,n.jsx)(t.p,{children:"This procedure creates a database containing the chain state, with full history since genesis state."}),"\n",(0,n.jsx)(t.h2,{id:"before-you-begin",children:"Before you begin"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Make sure ",(0,n.jsx)(t.a,{href:"/docs/getting-started/install-dependencies",children:"Wire core"})," is installed."]}),"\n",(0,n.jsxs)(t.li,{children:["Learn about ",(0,n.jsx)(t.a,{href:"/docs/api-reference/tooling/nodeop/usage/",children:"Using Nodeop"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Get familiar with ",(0,n.jsx)(t.a,{href:"/docs/api-reference/tooling/nodeop/plugins/state-history-plugin",children:"state_history_plugin"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"steps",children:"Steps"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["Enable the ",(0,n.jsx)(t.code,{children:"producer_api_plugin"})," on a node with full state-history."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["[[caution | Caution when using ",(0,n.jsx)(t.code,{children:"producer_api_plugin"}),"]]\n| Either use a firewall to block access to ",(0,n.jsx)(t.code,{children:"http-server-address"}),", or change it to ",(0,n.jsx)(t.code,{children:"localhost:8888"})," to disable remote access."]}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"Create a portable snapshot:"}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sh",children:"curl http://127.0.0.1:8888/v1/producer/create_snapshot | json_pp\n"})}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["Wait for ",(0,n.jsx)(t.code,{children:"nodeop"})," to process several blocks after the snapshot completed. The goal is for the state-history files to contain at least 1 more block than the portable snapshot has, and for the ",(0,n.jsx)(t.code,{children:"blocks.log"})," file to contain the block after it has become irreversible."]}),"\n"]}),"\n",(0,n.jsx)(t.admonition,{type:"info",children:(0,n.jsx)(t.p,{children:"| If the block included in the portable snapshot is forked out, then the snapshot will be invalid. Repeat this process if this happens."})}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Stop ",(0,n.jsx)(t.code,{children:"nodeop"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"Make backups of:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["The newly-created portable snapshot (",(0,n.jsx)(t.code,{children:"data/snapshots/snapshot-xxxxxxx.bin"}),")"]}),"\n",(0,n.jsxs)(t.li,{children:["The contents of ",(0,n.jsx)(t.code,{children:"data/state-history"}),":","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"chain_state_history.log"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"trace_history.log"})}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"chain_state_history.index"}),": optional. Restoring will take longer without this file."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"trace_history.index"}),": optional. Restoring will take longer without this file."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["Optional: the contents of ",(0,n.jsx)(t.code,{children:"data/blocks"}),", but excluding ",(0,n.jsx)(t.code,{children:"data/blocks/reversible"}),"."]}),"\n"]}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},28453:(e,t,o)=>{o.d(t,{R:()=>r,x:()=>l});var n=o(96540);const s={},i=n.createContext(s);function r(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);