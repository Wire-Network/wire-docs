"use strict";(self.webpackChunkwire_docs=self.webpackChunkwire_docs||[]).push([[8478],{56849:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>l});var a=t(74848),o=t(28453);const c={title:"Prune context-free data"},s=void 0,i={id:"api-reference/tooling/nodeop/how-to/how-to-prune-context-free-data",title:"Prune context-free data",description:"Summary",source:"@site/docs/api-reference/tooling/nodeop/how-to/how-to-prune-context-free-data.md",sourceDirName:"api-reference/tooling/nodeop/how-to",slug:"/api-reference/tooling/nodeop/how-to/how-to-prune-context-free-data",permalink:"/docs/api-reference/tooling/nodeop/how-to/how-to-prune-context-free-data",draft:!1,unlisted:!1,editUrl:"https://github.com/Wire-Network/wire-docs/docs/api-reference/tooling/nodeop/how-to/how-to-prune-context-free-data.md",tags:[],version:"current",frontMatter:{title:"Prune context-free data"}},r={},l=[{value:"Summary",id:"summary",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Procedure",id:"procedure",level:2},{value:"Notes",id:"notes",level:2},{value:"Example",id:"example",level:2},{value:"Transaction sample (before)",id:"transaction-sample-before",level:3},{value:"Steps",id:"steps",level:3},{value:"Transaction sample (after)",id:"transaction-sample-after",level:3},{value:"Notes",id:"notes-1",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsxs)(n.p,{children:["This how-to procedure showcases the steps to prune context-free data (CFD) from a transaction. The process involves launching the ",(0,a.jsx)(n.a,{href:"/docs/api-reference/tooling/utilities/sysio-blocklog",children:(0,a.jsx)(n.code,{children:"sysio-blocklog"})})," utility with the ",(0,a.jsx)(n.code,{children:"--prune-transactions"})," option, the transaction ID(s) that contain(s) the context-free data, and additional options as specified below."]}),"\n",(0,a.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsx)(n.p,{children:"The following items must be known in advance or completed before starting the procedure:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The ID of a retired transaction with context-free data in a finalized block."}),"\n",(0,a.jsxs)(n.li,{children:["Become familiar with the ",(0,a.jsx)(n.a,{href:"/docs/api-reference/tooling/nodeop/concepts/context-free-data",children:"context-free data"})," section of a transaction."]}),"\n",(0,a.jsxs)(n.li,{children:["Review the ",(0,a.jsx)(n.a,{href:"/docs/api-reference/tooling/utilities/sysio-blocklog",children:(0,a.jsx)(n.code,{children:"sysio-blocklog"})})," command-line utility reference."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"procedure",children:"Procedure"}),"\n",(0,a.jsx)(n.p,{children:"Complete the following steps to prune the context-free data from the transaction:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Locate the transaction ID you want to prune the context-free data from, e.g. ",(0,a.jsx)(n.code,{children:"<trx_id>"}),". The transaction ID can also be found on the ",(0,a.jsx)(n.code,{children:"id"})," field of the transaction."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Locate the block number that contains the transaction, e.g. ",(0,a.jsx)(n.code,{children:"<block_num>"}),". Make sure the block number matches the ",(0,a.jsx)(n.code,{children:"block_num"})," field of the transaction."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Find the blocks directory and state history directory (if applicable), e.g. ",(0,a.jsx)(n.code,{children:"<blocks_dir>"})," and ",(0,a.jsx)(n.code,{children:"<state_hist_dir>"}),", respectively."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Launch the ",(0,a.jsx)(n.a,{href:"/docs/api-reference/tooling/utilities/sysio-blocklog",children:(0,a.jsx)(n.code,{children:"sysio-blocklog"})})," utility as follows:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"sysio-blocklog [--blocks-dir <blocks_dir>] [--state-history-dir <state_hist_dir>] --prune-transactions --block-num <block_num> --transaction <trx_id> [--transaction <trx_id2> ...]"})}),"\n",(0,a.jsxs)(n.p,{children:["If the operation is ",(0,a.jsx)(n.em,{children:"successful"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.a,{href:"/docs/api-reference/tooling/utilities/sysio-blocklog",children:(0,a.jsx)(n.code,{children:"sysio-blocklog"})})," utility terminates silently with a zero error code (no error)."]}),"\n",(0,a.jsxs)(n.li,{children:["The following fields are updated within the pruned transaction from the block logs:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.code,{children:'prunable_data["prunable_data"][0]'})," field is set from 0 to 1."]}),"\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.code,{children:"signatures"})," field is set to an empty array."]}),"\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.code,{children:"context_free_data"})," field is set to an empty array."]}),"\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.code,{children:"packed_context_free_data"})," field, if any, is removed."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["If the operaton is ",(0,a.jsx)(n.em,{children:"unsuccessful"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.a,{href:"/docs/api-reference/tooling/utilities/sysio-blocklog",children:(0,a.jsx)(n.code,{children:"sysio-blocklog"})})," utility outputs an error to ",(0,a.jsx)(n.code,{children:"stderr"})," and terminates with a non-zero error code (indicating an error)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,a.jsx)(n.p,{children:"Some additional considerations are in order:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["You can pass multiple transactions to ",(0,a.jsx)(n.a,{href:"/docs/api-reference/tooling/utilities/sysio-blocklog",children:(0,a.jsx)(n.code,{children:"sysio-blocklog"})})," if they are within the same block."]}),"\n",(0,a.jsxs)(n.li,{children:["You can use ",(0,a.jsx)(n.a,{href:"/docs/api-reference/tooling/utilities/sysio-blocklog",children:(0,a.jsx)(n.code,{children:"sysio-blocklog"})})," to display the block that contains the pruned transactions."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,a.jsxs)(n.p,{children:["In this example, we reproduce the steps listed in the ",(0,a.jsx)(n.a,{href:"#procedure",children:"Procedure"})," section above."]}),"\n",(0,a.jsx)(n.h3,{id:"transaction-sample-before",children:"Transaction sample (before)"}),"\n",(0,a.jsx)(n.p,{children:"Refer to the following transaction sample with context-free data:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "id": "1b9a9c53f9b692d3382bcc19c0c21eb22207e2f51a30fe88dabbb45376b6ff23",\n  "trx": {\n    "receipt": {\n      "status": "executed",\n      "cpu_usage_us": 155,\n      "net_usage_words": 14,\n      "trx": [\n        1,\n        {\n          "compression": "none",\n          "prunable_data": {\n            "prunable_data": [\n              0,\n              {\n                "signatures": [\n                  "SIG_K1_K3AJXEMFH99KScLFC1cnLA3WDnVK7WRsS8BtafHfP4VWmfQXXwX21KATVVtrCqopkcve6V8noc5bS4BJkwgSsonpfpWEJi"\n                ],\n                "packed_context_free_data": "0203a1b2c3031a2b3c"\n              }\n            ]\n          },\n          "packed_trx": "ec42545f7500ffe8aa290000000100305631191abda90000000000901d4d00000100305631191abda90000000000901d4d0100305631191abda900000000a8ed32320000"\n        }\n      ]\n    },\n    "trx": {\n      "expiration": "2020-09-06T02:01:16",\n      "ref_block_num": 117,\n      "ref_block_prefix": 699066623,\n      "max_net_usage_words": 0,\n      "max_cpu_usage_ms": 0,\n      "delay_sec": 0,\n      "context_free_actions": [\n        {\n          "account": "payloadless",\n          "name": "doit",\n          "authorization": [],\n          "data": ""\n        }\n      ],\n      "actions": [\n        {\n          "account": "payloadless",\n          "name": "doit",\n          "authorization": [\n            {\n              "actor": "payloadless",\n              "permission": "active"\n            }\n          ],\n          "data": ""\n        }\n      ],\n      "signatures": [\n        "SIG_K1_K3AJXEMFH99KScLFC1cnLA3WDnVK7WRsS8BtafHfP4VWmfQXXwX21KATVVtrCqopkcve6V8noc5bS4BJkwgSsonpfpWEJi"\n      ],\n      "context_free_data": [\n        "a1b2c3",\n        "1a2b3c"\n      ]\n    }\n  },\n  "block_time": "2020-09-06T02:00:47.000",\n  "block_num": 119,\n  "last_irreversible_block": 128,\n  "traces": [\n    {\n      "action_ordinal": 1,\n      "creator_action_ordinal": 0,\n      "closest_unnotified_ancestor_action_ordinal": 0,\n      "receipt": {\n        "receiver": "payloadless",\n        "act_digest": "4f09a630d4456585ee4ec5ef96c14151587367ad381f9da445b6b6239aae82cf",\n        "global_sequence": 156,\n        "recv_sequence": 2,\n        "auth_sequence": [],\n        "code_sequence": 1,\n        "abi_sequence": 1\n      },\n      "receiver": "payloadless",\n      "act": {\n        "account": "payloadless",\n        "name": "doit",\n        "authorization": [],\n        "data": ""\n      },\n      "context_free": true,\n      "elapsed": 206,\n      "console": "Im a payloadless action",\n      "trx_id": "1b9a9c53f9b692d3382bcc19c0c21eb22207e2f51a30fe88dabbb45376b6ff23",\n      "block_num": 119,\n      "block_time": "2020-09-06T02:00:47.000",\n      "producer_block_id": null,\n      "account_ram_deltas": [],\n      "account_disk_deltas": [],\n      "except": null,\n      "error_code": null,\n      "return_value_hex_data": ""\n    },\n    {\n      "action_ordinal": 2,\n      "creator_action_ordinal": 0,\n      "closest_unnotified_ancestor_action_ordinal": 0,\n      "receipt": {\n        "receiver": "payloadless",\n        "act_digest": "b8871e8f3c79b02804a2ad28acb015f503e7f6e56f35565e5fa37b6767da1aa5",\n        "global_sequence": 157,\n        "recv_sequence": 3,\n        "auth_sequence": [\n          [\n            "payloadless",\n            3\n          ]\n        ],\n        "code_sequence": 1,\n        "abi_sequence": 1\n      },\n      "receiver": "payloadless",\n      "act": {\n        "account": "payloadless",\n        "name": "doit",\n        "authorization": [\n          {\n            "actor": "payloadless",\n            "permission": "active"\n          }\n        ],\n        "data": ""\n      },\n      "context_free": false,\n      "elapsed": 11,\n      "console": "Im a payloadless action",\n      "trx_id": "1b9a9c53f9b692d3382bcc19c0c21eb22207e2f51a30fe88dabbb45376b6ff23",\n      "block_num": 119,\n      "block_time": "2020-09-06T02:00:47.000",\n      "producer_block_id": null,\n      "account_ram_deltas": [],\n      "account_disk_deltas": [],\n      "except": null,\n      "error_code": null,\n      "return_value_hex_data": ""\n    }\n  ]\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"steps",children:"Steps"}),"\n",(0,a.jsx)(n.p,{children:"Using the above transaction to recreate the steps above:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Locate the transaction ID: ",(0,a.jsx)(n.code,{children:"1b9a9c53f9b692d3382bcc19c0c21eb22207e2f51a30fe88dabbb45376b6ff23"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Locate the block number: ",(0,a.jsx)(n.code,{children:"119"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Find the blocks directory and state history directory (if applicable), e.g. ",(0,a.jsx)(n.code,{children:"<blocks_dir>"})," and ",(0,a.jsx)(n.code,{children:"<state_hist_dir>"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Launch the ",(0,a.jsx)(n.a,{href:"/docs/api-reference/tooling/utilities/sysio-blocklog",children:(0,a.jsx)(n.code,{children:"sysio-blocklog"})})," utility as follows:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"sysio-blocklog --blocks-dir <blocks_dir> --state-history-dir <state_hist_dir> --prune-transactions --block-num 119 --transaction 1b9a9c53f9b692d3382bcc19c0c21eb22207e2f51a30fe88dabbb45376b6ff23"})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["If ",(0,a.jsx)(n.em,{children:"successful"}),", the utility returns silently. If ",(0,a.jsx)(n.em,{children:"unsuccessful"}),", it outputs an error to ",(0,a.jsx)(n.code,{children:"stderr"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"transaction-sample-after",children:"Transaction sample (after)"}),"\n",(0,a.jsx)(n.p,{children:"After retrieving the transaction a second time, the pruned transaction looks as follows:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "id": "1b9a9c53f9b692d3382bcc19c0c21eb22207e2f51a30fe88dabbb45376b6ff23",\n  "trx": {\n    "receipt": {\n      "status": "executed",\n      "cpu_usage_us": 155,\n      "net_usage_words": 14,\n      "trx": [\n        1,\n        {\n          "compression": "none",\n          "prunable_data": {\n            "prunable_data": [\n              1,\n              {\n                "digest": "6f29ea8ab323ffee90585238ff32300c4ee6aa563235ff05f3c1feb855f09189"\n              }\n            ]\n          },\n          "packed_trx": "ec42545f7500ffe8aa290000000100305631191abda90000000000901d4d00000100305631191abda90000000000901d4d0100305631191abda900000000a8ed32320000"\n        }\n      ]\n    },\n    "trx": {\n      "expiration": "2020-09-06T02:01:16",\n      "ref_block_num": 117,\n      "ref_block_prefix": 699066623,\n      "max_net_usage_words": 0,\n      "max_cpu_usage_ms": 0,\n      "delay_sec": 0,\n      "context_free_actions": [\n        {\n          "account": "payloadless",\n          "name": "doit",\n          "authorization": [],\n          "data": ""\n        }\n      ],\n      "actions": [\n        {\n          "account": "payloadless",\n          "name": "doit",\n          "authorization": [\n            {\n              "actor": "payloadless",\n              "permission": "active"\n            }\n          ],\n          "data": ""\n        }\n      ],\n      "signatures": [],\n      "context_free_data": []\n    }\n  },\n  "block_time": "2020-09-06T02:00:47.000",\n  "block_num": 119,\n  "last_irreversible_block": 131,\n  "traces": [\n    {\n      "action_ordinal": 1,\n      "creator_action_ordinal": 0,\n      "closest_unnotified_ancestor_action_ordinal": 0,\n      "receipt": {\n        "receiver": "payloadless",\n        "act_digest": "4f09a630d4456585ee4ec5ef96c14151587367ad381f9da445b6b6239aae82cf",\n        "global_sequence": 156,\n        "recv_sequence": 2,\n        "auth_sequence": [],\n        "code_sequence": 1,\n        "abi_sequence": 1\n      },\n      "receiver": "payloadless",\n      "act": {\n        "account": "payloadless",\n        "name": "doit",\n        "authorization": [],\n        "data": ""\n      },\n      "context_free": true,\n      "elapsed": 206,\n      "console": "Im a payloadless action",\n      "trx_id": "1b9a9c53f9b692d3382bcc19c0c21eb22207e2f51a30fe88dabbb45376b6ff23",\n      "block_num": 119,\n      "block_time": "2020-09-06T02:00:47.000",\n      "producer_block_id": null,\n      "account_ram_deltas": [],\n      "account_disk_deltas": [],\n      "except": null,\n      "error_code": null,\n      "return_value_hex_data": ""\n    },\n    {\n      "action_ordinal": 2,\n      "creator_action_ordinal": 0,\n      "closest_unnotified_ancestor_action_ordinal": 0,\n      "receipt": {\n        "receiver": "payloadless",\n        "act_digest": "b8871e8f3c79b02804a2ad28acb015f503e7f6e56f35565e5fa37b6767da1aa5",\n        "global_sequence": 157,\n        "recv_sequence": 3,\n        "auth_sequence": [\n          [\n            "payloadless",\n            3\n          ]\n        ],\n        "code_sequence": 1,\n        "abi_sequence": 1\n      },\n      "receiver": "payloadless",\n      "act": {\n        "account": "payloadless",\n        "name": "doit",\n        "authorization": [\n          {\n            "actor": "payloadless",\n            "permission": "active"\n          }\n        ],\n        "data": ""\n      },\n      "context_free": false,\n      "elapsed": 11,\n      "console": "Im a payloadless action",\n      "trx_id": "1b9a9c53f9b692d3382bcc19c0c21eb22207e2f51a30fe88dabbb45376b6ff23",\n      "block_num": 119,\n      "block_time": "2020-09-06T02:00:47.000",\n      "producer_block_id": null,\n      "account_ram_deltas": [],\n      "account_disk_deltas": [],\n      "except": null,\n      "error_code": null,\n      "return_value_hex_data": ""\n    }\n  ]\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"notes-1",children:"Notes"}),"\n",(0,a.jsx)(n.p,{children:"Notice the following modified fields within the pruned transaction:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.code,{children:'prunable_data["prunable_data"][0]'})," field is 1."]}),"\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.code,{children:"signatures"})," field now contains an empty array."]}),"\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.code,{children:"context_free_data"})," field contains an empty array."]}),"\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.code,{children:"packed_context_free_data"})," field is removed."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsx)(n.p,{children:"The following actions are available after you complete the procedure:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Verify that the pruned transaction indeed contains pruned context-free data."}),"\n",(0,a.jsx)(n.li,{children:"Display the block that contains the pruned transaction from the block logs."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>i});var a=t(96540);const o={},c=a.createContext(o);function s(e){const n=a.useContext(c);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),a.createElement(c.Provider,{value:n},e.children)}}}]);